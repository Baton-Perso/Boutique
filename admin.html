<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - PHONE&CO</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --violet: #6f42c1; --dark: #333; --bg: #f0f2f5; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; }
        
        .sidebar { width: 260px; background: white; height: 100vh; position: fixed; padding: 20px; box-shadow: 2px 0 10px rgba(0,0,0,0.05); overflow-y: auto; }
        .main { margin-left: 300px; padding: 40px; width: calc(100% - 340px); }
        
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 30px; }
        h2 { color: var(--violet); border-left: 5px solid var(--violet); padding-left: 15px; margin-bottom: 20px; }
        
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        input, select, button { padding: 12px; border-radius: 8px; border: 1px solid #ddd; font-size: 14px; width: 100%; box-sizing: border-box; }
        
        button { background: var(--violet); color: white; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        button:hover { opacity: 0.9; transform: translateY(-2px); }
        
        .section-title { font-weight: 800; text-transform: uppercase; font-size: 11px; color: #888; margin-top: 25px; margin-bottom: 10px; display: block; border-bottom: 1px solid #eee; padding-bottom: 5px;}
        .admin-nav-item { display: block; padding: 10px; color: var(--dark); text-decoration: none; font-weight: 500; border-radius: 8px; transition: 0.2s; }
        .admin-nav-item:hover { background: #f3ebff; color: var(--violet); }
    </style>
</head>
<body>

<div class="sidebar">
    <h1 style="color:var(--violet); font-size: 22px;">PHONE&CO Admin</h1>
    <a href="index.html" class="admin-nav-item">‚Üê Voir le site</a>
    
    <p class="section-title">Boutique</p>
    <a href="#section-filtres-boutique" class="admin-nav-item">‚Ä¢ G√©rer Marques/Cat√©gories</a>
    <a href="#section-accessoires" class="admin-nav-item">‚Ä¢ Ajouter un Produit</a>
    
    <p class="section-title">R√©parations</p>
    <a href="#section-reparations" class="admin-nav-item">‚Ä¢ Configurer les tarifs</a>
</div>

<div class="main">

    <div id="section-filtres-boutique" class="card">
        <h2>üõ†Ô∏è Param√®tres de la Boutique</h2>
        <div class="form-grid">
            <div>
                <p class="section-title">Ajouter une Marque d'accessoire</p>
                <input type="text" id="new-prod-brand" placeholder="Ex: Belkin, Apple...">
                <button onclick="addFilter('product_brands', 'new-prod-brand')">Ajouter la Marque</button>
            </div>
            <div>
                <p class="section-title">Ajouter une Cat√©gorie</p>
                <input type="text" id="new-prod-cat" placeholder="Ex: Audio, Coques...">
                <button onclick="addFilter('product_categories', 'new-prod-cat')">Ajouter la Cat√©gorie</button>
            </div>
        </div>
    </div>

    <div id="section-accessoires" class="card">
        <h2>üì¶ Ajouter un Produit / Accessoire</h2>
        <div class="form-grid">
            <input type="text" id="acc-name" placeholder="Titre du produit (ex: Coque Silicone iPhone 13)" style="grid-column: span 2;">
            
            <select id="acc-brand-select">
                <option value="">Chargement des marques...</option>
            </select>
            
            <select id="acc-cat-select">
                <option value="">Chargement des cat√©gories...</option>
            </select>

            <input type="number" step="0.01" id="acc-price" placeholder="Prix (‚Ç¨)">
            <input type="number" id="acc-stock" placeholder="Nombre en stock">
            
            <input type="text" id="acc-img" placeholder="URL de la photo du produit" style="grid-column: span 2;">
        </div>
        <button onclick="addAccessory()" style="background:#28a745;">Enregistrer en boutique</button>
    </div>

    <div id="section-reparations" class="card">
        <h2>üîß Configuration des R√©parations</h2>
        
        <p class="section-title">√âtape 1 : Ajouter une Marque de t√©l√©phone</p>
        <div class="form-grid">
            <input type="text" id="rep-brand-name" placeholder="Nom (Apple, Samsung...)">
            <input type="text" id="rep-brand-logo" placeholder="URL du Logo">
        </div>
        <button onclick="addRepairBrand()">Ajouter la Marque</button>

        <p class="section-title">√âtape 2 : Ajouter un Mod√®le</p>
        <div class="form-grid">
            <select id="select-brand-for-model"><option>Chargement...</option></select>
            <input type="text" id="rep-model-name" placeholder="iPhone 14 Pro">
            <input type="text" id="rep-model-img" placeholder="URL Photo" style="grid-column: span 2;">
        </div>
        <button onclick="addRepairModel()">Ajouter le Mod√®le</button>

        <p class="section-title">√âtape 3 : Ajouter une Panne & Prix</p>
        <div class="form-grid">
            <input type="text" id="rep-type-name" placeholder="Type (√âcran LCD, Batterie...)">
            <input type="number" step="0.01" id="rep-type-price" placeholder="Prix (‚Ç¨)">
        </div>
        <button onclick="addRepairType()">Enregistrer la Panne</button>
    </div>

</div>

<script>
    const SB_URL = "https://rryfiyupsmdqranvuqmx.supabase.co";
    const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJyeWZpeXVwc21kcXJhbnZ1cW14Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyNDU5MTcsImV4cCI6MjA4NjgyMTkxN30.JzzAt3ejHhg66unhyw9Fc_uvlvtgJ4h7Pss5TUupD3g";
    const supabaseClient = supabase.createClient(SB_URL, SB_KEY);

    // --- INITIALISATION ---
    async function init() {
        loadRepairBrands();
        loadProductFilters();
    }

    // --- GESTION FILTRES BOUTIQUE ---
    async function loadProductFilters() {
        const { data: brands } = await supabaseClient.from('product_brands').select('*');
        const { data: cats } = await supabaseClient.from('product_categories').select('*');

        const bSelect = document.getElementById('acc-brand-select');
        const cSelect = document.getElementById('acc-cat-select');

        bSelect.innerHTML = '<option value="">Choisir la marque...</option>';
        brands?.forEach(b => bSelect.innerHTML += `<option value="${b.name}">${b.name}</option>`);

        cSelect.innerHTML = '<option value="">Choisir la cat√©gorie...</option>';
        cats?.forEach(c => cSelect.innerHTML += `<option value="${c.name}">${c.name}</option>`);
    }

    async function addFilter(table, inputId) {
        const name = document.getElementById(inputId).value;
        if(!name) return alert("Veuillez saisir un nom");

        const { error } = await supabaseClient.from(table).insert([{ name }]);
        if (error) alert("Erreur : " + error.message);
        else {
            alert("Ajout√© !");
            document.getElementById(inputId).value = "";
            loadProductFilters();
        }
    }

    // --- ACCESSOIRES ---
    async function addAccessory() {
        const name = document.getElementById('acc-name').value;
        const brand = document.getElementById('acc-brand-select').value;
        const category = document.getElementById('acc-cat-select').value;
        const price = parseFloat(document.getElementById('acc-price').value);
        const stock = parseInt(document.getElementById('acc-stock').value) || 0;
        const image = document.getElementById('acc-img').value;

        if(!name || !brand || !category || isNaN(price)) return alert("Remplissez tous les champs");

        const { error } = await supabaseClient.from('products').insert([{
            name, brand, price, category, stock, image_url: image
        }]);

        if (error) alert("Erreur : " + error.message);
        else { alert("Produit enregistr√© !"); location.reload(); }
    }

    // --- R√âPARATIONS ---
    async function loadRepairBrands() {
        const { data } = await supabaseClient.from('repair_brands').select('*');
        const select = document.getElementById('select-brand-for-model');
        select.innerHTML = '<option value="">Choisir la marque...</option>';
        data?.forEach(b => select.innerHTML += `<option value="${b.id}">${b.name}</option>`);
    }

    async function addRepairBrand() {
        const { error } = await supabaseClient.from('repair_brands').insert([{ 
            name: document.getElementById('rep-brand-name').value,
            logo_url: document.getElementById('rep-brand-logo').value 
        }]);
        if (error) alert("Erreur : " + error.message);
        else { alert("Marque de t√©l√©phone ajout√©e !"); loadRepairBrands(); }
    }

    async function addRepairModel() {
        const { error } = await supabaseClient.from('repair_models').insert([{ 
            brand_id: document.getElementById('select-brand-for-model').value,
            name: document.getElementById('rep-model-name').value,
            image_url: document.getElementById('rep-model-img').value
        }]);
        if (error) alert("Erreur : " + error.message);
        else alert("Mod√®le ajout√© !");
    }

    async function addRepairType() {
        const { error } = await supabaseClient.from('repair_types').insert([{ 
            name: document.getElementById('rep-type-name').value,
            price: parseFloat(document.getElementById('rep-type-price').value)
        }]);
        if (error) alert("Erreur : " + error.message);
        else alert("R√©paration enregistr√©e !");
    }

    init();
</script>
</body>
</html>